// Generated by CoffeeScript 1.9.0
(function() {
  var COOKIE_NAME, User;

  COOKIE_NAME = 'nodeChatUser';

  User = (function() {
    function User(opts) {
      opts = window.$.extend({}, opts);
      this._onChangeNick = opts.onChangeNick;
      this._init(opts.nick);
    }

    User.prototype._init = function(nick) {
      var cookie;
      this.loggedIn = false;
      cookie = this.loadCookie();
      if (cookie) {
        this.setNick(cookie.nick, false);
        return this.loggedIn = true;
      } else {
        return this.setNick(nick != null ? nick : 'Аноним', false);
      }
    };

    User.prototype.loadCookie = function() {
      var cookie;
      cookie = $.cookie(COOKIE_NAME);
      if (cookie) {
        return cookie = JSON.parse(cookie);
      } else {
        return cookie = null;
      }
    };

    User.prototype.saveCookie = function() {
      var cookie;
      cookie = {
        nick: this.nick
      };
      return $.cookie(COOKIE_NAME, JSON.stringify(cookie));
    };

    User.prototype.setNick = function(nick, saveCookie) {
      var oldNick;
      if (saveCookie == null) {
        saveCookie = true;
      }
      oldNick = this.nick;
      this.nick = nick;
      if (saveCookie) {
        this.saveCookie();
      }
      if (this._onChangeNick) {
        return this._onChangeNick(oldNick, nick);
      }
    };

    return User;

  })();

  window.User = User;

}).call(this);

//# sourceMappingURL=User.js.map
